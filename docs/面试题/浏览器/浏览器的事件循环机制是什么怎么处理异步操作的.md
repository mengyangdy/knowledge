---
title: 浏览器的事件循环机制是什么怎么处理异步操作的?
tags:
  - 浏览器
  - 面试题
date: 2024-05-27
---
# 一浏览器的事件循环机制是什么?怎么处理异步操作的?

## 1.1 基本概念

1. **执行栈**：JavaScript代码在执行时，会形成一个调用栈，也就是执行栈，它遵循先进后出的原则，记录着当前执行的函数调用序列。
    
2. **任务队列**：分为**宏任务队列**（Macrotask Queue）和**微任务队列**（Microtask Queue）。异步任务完成后，会被放入相应的任务队列等待执行。

## 1.2 事件循环的步骤

1. **执行全局脚本**：浏览器首先执行全局脚本中的同步代码，这些代码构成最初的执行栈。
    
2. **检查微任务队列**：在当前执行栈清空后，事件循环会检查微任务队列。如果有微任务，会立即执行它们，直到微任务队列为空。
    
3. **执行宏任务**：接下来，事件循环会从宏任务队列中取出一个任务，将其推入执行栈执行。这通常涉及到渲染、处理网络响应等操作。
    
4. **再次检查微任务队列**：在宏任务执行完毕后，再次检查微任务队列，并执行其中的所有任务，这个过程会重复，直到微任务队列为空。
    
5. **循环进行**：重复步骤3和4，即执行下一个宏任务，然后检查并执行所有微任务，形成了一个循环。

## 1.3 宏任务与微任务

- **宏任务**（Macrotasks）：包括Script（整体代码块）、setTimeout、setInterval、I/O、UI渲染用户交互事件等。
- **微任务**（Microtasks）：包括Promise的回调（`.then`、`.catch`）、MutationObserver、process.nextTick（Node.js环境）等。

## 1.4 异步操作处理

当遇到异步操作时，比如`setTimeout`、`fetch`请求或者`Promise`，这些操作并不会立即执行，而是由浏览器安排在适当的时机执行。例如，对于`setTimeout`，浏览器会在指定的时间后将回调函数放入宏任务队列；而对于`Promise`，其`.then`或`.catch`的回调会放入微任务队列。

通过这种方式，即使JavaScript是单线程的，也能高效地处理并发操作，确保了即使有长时间运行的代码也不会阻塞用户界面的更新或其他脚本的执行。