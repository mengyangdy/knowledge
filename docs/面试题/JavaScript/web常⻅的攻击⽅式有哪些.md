---
title: web常⻅的攻击⽅式有哪些?
tags:
  - js
  - 面试题
date: 2024-06-12
---

# web常⻅的攻击⽅式有哪些?

## 1 是什么

Web攻击（WebAttack）是针对⽤⼾上⽹⾏为或⽹站服务器等设备进⾏攻击的⾏为

如植⼊恶意代码，修改⽹站权限，获取⽹站⽤⼾隐私信息等等

Web应⽤程序的安全性是任何基于Web业务的重要组成部分

确保Web应⽤程序安全⼗分重要，即使是代码中很⼩的 bug 也有可能导致隐私信息被泄露

站点安全就是为保护站点不受未授权的访问、使⽤、修改和破坏⽽采取的⾏为或实践

我们常⻅的Web攻击⽅式有:
- XSS (Cross Site Scripting) 跨站脚本攻击
- CSRF（Cross-site request forgery）跨站请求伪造
- SQL注⼊攻击

## 2 XSS

XSS，跨站脚本攻击，允许攻击者将恶意代码植⼊到提供给其它⽤⼾使⽤的⻚⾯中

XSS涉及到三⽅，即攻击者、客⼾端与Web应⽤

XSS的攻击⽬标是为了盗取存储在客⼾端的cookie或者其他⽹站⽤于识别客⼾端⾝份的敏感信息。⼀旦获取到合法⽤⼾的信息后，攻击者甚⾄可以假冒合法⽤⼾与⽹站进⾏交互

举个例⼦：

⼀个搜索⻚⾯，根据url参数决定关键词的内容,这⾥看似并没有问题，但是如果不按套路出牌呢？

⽤⼾输⼊`<script>alert('XSS');</script>`，拼接到 HTML 中返回给浏览器。形成了如下的 HTML

浏览器⽆法分辨出 `<script>alert('XSS');</script>` 是恶意代码，因⽽将其执⾏，试想⼀下，如果是获取cookie发送对⿊客服务器呢？

根据攻击的来源，XSS攻击可以分成：

- 存储型
- 反射型
- DOM 型

### 2.1 存储型

存储型 XSS 的攻击步骤：
1. 攻击者将恶意代码提交到⽬标⽹站的数据库中
2. ⽤⼾打开⽬标⽹站时，⽹站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器
3. ⽤⼾浏览器接收到响应后解析执⾏，混在其中的恶意代码也被执⾏
4. 恶意代码窃取⽤⼾数据并发送到攻击者的⽹站，或者冒充⽤⼾的⾏为，调⽤⽬标⽹站接⼝执⾏攻击者指定的操作

这种攻击常⻅于带有⽤⼾保存数据的⽹站功能，如论坛发帖、商品评论、⽤⼾私信等

### 2.2 反射型 XSS

反射型 XSS 的攻击步骤：
1. 攻击者构造出特殊的 URL，其中包含恶意代码
2. ⽤⼾打开带有恶意代码的 URL 时，⽹站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器
3. ⽤⼾浏览器接收到响应后解析执⾏，混在其中的恶意代码也被执⾏
4. 恶意代码窃取⽤⼾数据并发送到攻击者的⽹站，或者冒充⽤⼾的⾏为，调⽤⽬标⽹站接⼝执⾏攻击者指定的操作

反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库⾥，反射型 XSS 的恶意代码存在 URL ⾥。

反射型 XSS 漏洞常⻅于通过 URL 传递参数的功能，如⽹站搜索、跳转等。

由于需要⽤⼾主动打开恶意的 URL 才能⽣效，攻击者往往会结合多种⼿段诱导⽤⼾点击。

POST 的内容也可以触发反射型 XSS，只不过其触发条件⽐较苛刻（需要构造表单提交⻚⾯，并引导⽤⼾点击），所以⾮常少⻅

### 2.3 DOM 型 XSS

DOM 型 XSS 的攻击步骤：

1. 攻击者构造出特殊的 URL，其中包含恶意代码
2. ⽤⼾打开带有恶意代码的 URL
3. ⽤⼾浏览器接收到响应后解析执⾏，前端 JavaScript 取出 URL 中的恶意代码并执⾏
4. 恶意代码窃取⽤⼾数据并发送到攻击者的⽹站，或者冒充⽤⼾的⾏为，调⽤⽬标⽹站接⼝执⾏攻击者指定的操作

DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执⾏恶意代码由浏览器端完成，属于前端 JavaScript ⾃⾝的安全漏洞，⽽其他两种 XSS 都属于服务端的安全漏洞

### 2.4 XSS的预防

通过前⾯介绍，看到XSS攻击的两⼤要素：
- 攻击者提交⽽恶意代码
- 浏览器执⾏恶意代码

针对第⼀个要素，我们在⽤⼾输⼊的过程中，过滤掉⽤⼾输⼊的恶意代码，然后提交给后端，但是如果攻击者绕开前端请求，直接构造请求就不能预防了

⽽如果在后端写⼊数据库前，对输⼊进⾏过滤，然后把内容给前端，但是这个内容在不同地⽅就会有不同显⽰

例如：

⼀个正常的⽤⼾输⼊了 5 < 7 这个内容，在写⼊数据库前，被转义，变成了 5 < 7

在客⼾端中，⼀旦经过了 escapeHTML()，客⼾端显⽰的内容就变成了乱码( 5 < 7 )

在前端中，不同的位置所需的编码也不同:
- 当 5 < 7 作为 HTML 拼接⻚⾯时，可以正常显⽰：
- 当 5 < 7 通过 Ajax 返回，然后赋值给 JavaScript 的变量时，前端得到的字符串就是转义后的字符。

这个内容不能直接⽤于 Vue 等模板的展⽰，也不能直接⽤于内容⻓度计算。不能⽤于标题、alert 等

可以看到，过滤并⾮可靠的，下⾯就要通过防⽌浏览器执⾏恶意代码：
1. 在使⽤ .innerHTML、.outerHTML、document.write() 时要特别⼩⼼，不要把不可信的数据作为HTML 插到⻚⾯上，⽽应尽量使⽤ .textContent、.setAttribute() 等
2. 如果⽤ Vue/React 技术栈，并且不使⽤ v-html/dangerouslySetInnerHTML 功能，就在前端 render段避免 innerHTML、outerHTML 的 XSS 隐患
3. DOM 中的内联事件监听器，如 location、onclick、onerror、onload、onmouseover 等，`<a>`标签的 href 属性，JavaScript 的 eval()、setTimeout()、setInterval() 等，都能把字符串作为代码运⾏。

如果不可信的数据拼接到字符串中传递给这些 API，很容易产⽣安全隐患，请务必避免

## 3 CSRF
CSRF（Cross-site request forgery）跨站请求伪造：攻击者诱导受害者进⼊第三⽅⽹站，在第三⽅⽹站中，向被攻击⽹站发送跨站请求

利⽤受害者在被攻击⽹站已经获取的注册凭证，绕过后台的⽤⼾验证，达到冒充⽤⼾对被攻击的⽹站执⾏某项操作的目的

⼀个典型的CSRF攻击有着如下的流程：
- 受害者登录a.com，并保留了登录凭证（Cookie）
- 攻击者引诱受害者访问了b.com
- b.com 向 a.com 发送了⼀个请求：a.com/act=xx。浏览器会默认携带a.com的Cookie
- a.com接收到请求后，对请求进⾏验证，并确认是受害者的凭证，误以为是受害者⾃⼰发送的请求
- a.com以受害者的名义执⾏了act=xx
- 攻击完成，攻击者在受害者不知情的情况下，冒充受害者，让a.com执⾏了⾃⼰定义的操作

csrf可以通过get请求，即通过访问img的⻚⾯后，浏览器⾃动访问⽬标地址，发送请求

同样，也可以设置⼀个⾃动提交的表单发送post请求

访问该⻚⾯后，表单会⾃动提交，相当于模拟⽤⼾完成了⼀次POST操作

还有⼀种为使⽤a标签的，需要⽤⼾点击链接才会触发

访问该⻚⾯后，表单会⾃动提交，相当于模拟⽤⼾完成了⼀次POST操作

### 3.1 CSRF的特点

- 攻击⼀般发起在第三⽅⽹站，⽽不是被攻击的⽹站。被攻击的⽹站⽆法防⽌攻击发⽣
- 攻击利⽤受害者在被攻击⽹站的登录凭证，冒充受害者提交操作；⽽不是直接窃取数据
- 整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒⽤”
- 跨站请求可以⽤各种⽅式：图⽚URL、超链接、CORS、Form提交等等。部分请求⽅式可以直接嵌⼊在第三⽅论坛、⽂章中，难以进⾏追踪

### 3.2 CSRF的预防

CSRF通常从第三⽅⽹站发起，被攻击的⽹站⽆法防⽌攻击发⽣，只能通过增强⾃⼰⽹站针对CSRF的防护能⼒来提升安全性

防⽌csrf常⽤⽅案如下：
- 阻⽌不明外域的访问
	- 同源检测
	- Samesite Cookie
- 提交时要求附加本域才能获取的信息
	- CSRF Token
	- 双重Cookie验证

这⾥主要讲讲token这种形式，流程如下：
- ⽤⼾打开⻚⾯的时候，服务器需要给这个⽤⼾⽣成⼀个Token
- 对于GET请求，Token将附在请求地址之后。对于 POST 请求来说，要在 form 的最后加上
- 当⽤⼾从客⼾端得到了Token，再次提交给服务器的时候，服务器需要判断Token的有效性

## 4 SQL注⼊

Sql 注⼊攻击，是通过将恶意的 Sql查询或添加语句插⼊到应⽤的输⼊参数中，再在后台 Sql服务器上解析执⾏进⾏的攻击

SQL注⼊流程如下所⽰：
- 找出SQL漏洞的注⼊点
- 判断数据库的类型以及版本
- 猜解⽤⼾名和密码
- 利⽤⼯具查找Web后台管理⼊⼝
- ⼊侵和破坏

预防⽅式如下：
- 严格检查输⼊变量的类型和格式
- 过滤和转义特殊字符
- 对访问数据库的Web应⽤程序采⽤Web应⽤防⽕墙
上述只是列举了常⻅的web攻击⽅式，实际开发过程中还会遇到很多安全问题，对于这些问题，切记不可忽视