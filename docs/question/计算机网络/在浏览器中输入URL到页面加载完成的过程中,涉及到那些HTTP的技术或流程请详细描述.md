# 在浏览器中输入URL到页面加载完成的过程中,涉及到那些HTTP的技术或流程?请详细描述

在浏览器中输入URL到页面加载完成的过程中，涉及到了一系列复杂的HTTP技术及流程，主要包括以下步骤：

## 1.1 **解析URL**

- 当在浏览器中输入一个URL比如`baidu.com`时，浏览器首先解析用户输入的URL，提取协议、主机名、路径和查询字符串等信息。

## 1.2 **DNS解析**

**缓存查找过程**：

- **浏览器缓存**：⾸先，浏览器会检查它的缓存中是否有这个域名的记录，因为之前访问过的⽹址的解析结果可能会被存储在浏览器缓存中
- **操作系统缓存**：如果浏览器缓存中没有找到，浏览器会询问操作系统，因为操作系统也可能有⾃⼰的DNS缓存
- **路由器缓存**：如果操作系统中也没有找到，请求会发送到本地⽹络的路由器，它同样可能有⾃⼰的DNS缓存
- **ISP(Internet service provider)缓存**：如果以上都没有缓存记录，请求最终会发送到你的互联⽹服务提供商（ISP），它们通常会有更⼤范围的DNS缓存

**DNS递归解析**：

如果所有本地缓存查找都失败，DNS查询就变成了⼀个递归查询过程，涉及到多个DNS服务器：

- **根域名服务器**：⾸先，你的DNS查询会被发送到根域名服务器。根服务器是最⾼级别的DNS服务器，负责重定向到负责管理顶级域名（如.com、.net等）的顶级域名服务器
- **顶级域名服务器（****TLD****服务器）**：根服务器会告诉你的ISP的DNS服务器去查询哪个顶级域名服务器来找到.com 域的信息。这个服务器掌握所有.com 域名及其相应服务器的信息
- **权威域名服务器**：⼀旦你的DNS查询到达了正确的顶级域名服务器，它会进⼀步定向到负责example.com的权威服务器。权威服务器有该域名对应的具体IP地址

**IP地址的获取**：

- 最终，权威域名服务器会提供 www.example.com 域名对应的IP地址（如图中的93.184.216.34），这个信息会被发送回⽤户的电脑

**缓存结果**：⼀旦IP地址被找到，它通常会被存储在浏览器、操作系统、路由器或ISP的DNS缓存中，以便未来的查询可以更快得到解析



## 1.3 **建立TCP连接**

- 虽然我们是发送的HTTP请求，但是HTTP协议是应⽤层协议，它是建⽴在TCP传输层协议之上的，所以我们需要先进⾏TCP连接。

- TCP的连接会经常三次握⼿，客户端发送SYN包，服务器接收到后返回⼀个SYN-ACK包，客户端再次发送⼀个ACK包，完成握⼿过程。

- 此时TCP连接建⽴完成，双⽅就可以开始传输数据了。

## 1.4 **发送HTTP请求**

- ⼀旦TCP建⽴连接成功，客户端就可以通过这个链接发送HTTP请求，包括请求⽅法、URI、协议版本、请求头、请求体。

- 服务器收到HTTP请求后，会处理这个请求，并且返回⼀个HTTP响应。

- HTTP响应包括状态码、响应头、响应内容，我们这⾥请求的通常是index.html⽂件

## 1.5 **服务器处理请求**

- **路由解析**：服务器根据URL路径解析请求，决定由哪个后端服务或脚本来处理。
- **处理与响应**：服务器处理请求，可能涉及数据库查询、文件读取、业务逻辑处理等操作。完成后，构造HTTP响应报文，包括状态码（如200表示成功）、响应头（如Content-Type、Set-Cookie等）和响应体（如HTML页面、图片数据、JSON数据等）。

## 1.6 **接收响应**

- 浏览器接收服务器返回的HTTP响应，开始解析响应头和响应体。

## 1.7 **渲染页面**

- **解析HTML**：浏览器解析HTML文档，通过解析HTML来构建DOM Tree，在这个过程中它会遇到CSS⽂件和JS⽂件。
- **下载资源**：对于HTML中的外部资源（如CSS、JavaScript、图片等），浏览器会根据URL发起额外的HTTP请求进行下载。
- **渲染与布局**
  - DOM Tree和CSSOM可以共同来构建Render Tree。
  - 之后会在Render Tree上运⾏布局layout计算每个阶段的⼏何体。
  - 再由浏览器将每个阶段绘制paint到屏幕上的像素点

- composite合成
  - 这⾥还有⼀个优化的⼿段是将元素绘制到多个合成图层中。
  - 默认情况下，标准流中的内容是被绘制到同⼀个图层（Layer）中的。
  - 我们可以通过⼀些特定的⽅法来创建新的合成层（CompositingLayer），新的图层可以利⽤GPU来加速绘制。
  - ⽐如我们通过3DTransforms/video/canvas/ifram/positionfixed/will-change等
  - 但是分层确实可以提供性能，但是它是以内存管理为代价的。


## 1.8 **连接管理**

- 根据HTTP/1.1及之前的规范，每完成一个请求响应周期，TCP连接可能关闭；而HTTP/2引入了多路复用，可以在单个TCP连接上并行处理多个请求响应，提高效率。
- **Keep-Alive**：即使是HTTP/1.1，也支持Keep-Alive选项，保持连接一段时间，以复用连接发送后续请求。

## 1.9 **页面交互**

- 页面加载完成后，用户可以与页面交互，触发更多HTTP请求，如Ajax请求，此过程可能重复上述部分步骤。

以上流程概括了从输入URL到页面完全加载完成涉及的主要HTTP技术和流程，展示了浏览器与服务器间复杂的交互和数据交换过程。

