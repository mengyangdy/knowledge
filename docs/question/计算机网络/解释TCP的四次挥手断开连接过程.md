---
title: 解释TCP的四次挥手断开连接过程
tags:
  - 计算机网络
  - 面试题
date: 2024-06-03
---
# 一解释TCP的四次挥手断开连接过程

TCP的四次挥手（Four-Way Handshake）是指在TCP连接终止过程中，客户端和服务器之间需要交换四个报文段来确保双方都知道连接正在关闭，并且可以安全地释放资源。这一过程保证了数据的可靠传输直到连接结束。以下是四次挥手的具体步骤：

1. **第一次挥手（FIN）**:
    
    - 客户端决定终止连接时，向服务器发送一个报文段，其中：
        - **FIN (Finish)** 标志位被置为1，表示客户端没有更多数据要发送了。
        - **Sequence Number** 设置为客户端当前的序列号。
    - 这标志着数据传输的单方向结束，但连接还未完全关闭，因为服务器可能还有数据需要发送给客户端。
2. **第二次挥手（ACK）**:
    
    - 服务器接收到客户端的FIN报文段后，回复一个确认报文段，其中：
        - **ACK** 标志位被置为1。
        - **Acknowledgment Number** 设置为客户端FIN报文段的序列号加1，确认收到了FIN报文。
        - **Sequence Number** 为服务器当前的序列号。
    - 此时，从客户端到服务器的方向已经关闭，但服务器到客户端的方向仍然保持开放状态，等待数据传输完毕或超时。
3. **第三次挥手（FIN）**:
    
    - 当服务器也准备好关闭连接时，它会向客户端发送一个带有FIN标志的报文段，表明其也没有更多数据要发送了。
        - **FIN** 标志位被置为1。
        - **Sequence Number** 设置为服务器当前的序列号。
    - 这表示服务器也完成了数据发送，准备关闭连接。
4. **第四次挥手（ACK）**:
    
    - 客户端收到服务器的FIN报文后，回复一个确认报文段，其中：
        - **ACK** 标志位被置为1。
        - **Acknowledgment Number** 设置为服务器FIN报文段的序列号加1，确认收到了FIN。
        - **Sequence Number** 为客户端当前的序列号。
    - 至此，双方都确认了连接的关闭，但每个方向的关闭都需要独立确认，因此需要两个FIN和两个ACK。

完成这四次挥手后，连接进入TIME-WAIT状态，等待足够的时间以确保所有报文段都已到达对方并处理，避免数据丢失或重复，之后连接彻底关闭。这个等待时间通常是2MSL（Maximum Segment Lifetime，最大报文生存时间）。

