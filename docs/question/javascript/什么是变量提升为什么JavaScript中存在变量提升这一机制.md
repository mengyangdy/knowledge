---
title: 什么是变量提升为什么JavaScript中存在变量提升这一机制?
tags:
  - js
  - 面试题
date: 2024-05-26
---
# 一 什么是变量提升？为什么JavaScript中存在变量提升这一机制?

变量提升（Hoisting）是 JS 中的一种特性，它指的是在代码执行前，编译阶段会自动将变量声明（使用 `var`、`let`、`const` 关键字的声明）和函数声明（但不包括函数表达式）移至当前作用域的顶部。这意味着即使你在代码中将变量或函数声明放在了逻辑执行之后的位置，它们在逻辑上仍然会被当作在作用域的最开始就被声明了。

## 1.1 变量提升的具体表现：

- **变量声明提升**：使用`var`声明的变量会被提升至所在作用域的顶部，并初始化为`undefined`。注意，只有声明会被提升，赋值操作不会提升。
- **函数声明提升**：整个函数声明会被提升，因此可以在声明之前调用函数。
- **let和const声明**：虽然这些ES6引入的声明也会被提升，但它们不会被初始化为`undefined`，而是处于一个“临时死区”（temporal dead zone, TDZ），在此区域内访问这些变量会引发引用错误。

## 1.2 为什么存在变量提升机制？

变量提升的设计初衷主要是为了简化实现和提高代码的灵活性，源自于JavaScript作为一门解释执行的脚本语言，其设计初期需要快速灵活地处理变量和函数。具体原因包括：

1. **编译器优化**：在早期JavaScript引擎中，提升机制允许编译器在执行前快速扫描并准备好所有变量和函数声明，减少了运行时的开销。
2. **便于实现**：这样的机制简化了语言实现的复杂度，尤其是在早期JavaScript实现中，它帮助避免了在执行过程中不断回溯寻找变量声明的问题。
3. **允许提前调用**：允许函数在声明之前被调用，这对于某些编程模式和库的编写非常有用，提高了代码的灵活性。

## 1.3 变量提升的缺点

1. **代码可读性和维护性降低**：由于变量和函数可以在声明之前被使用，这可能导致代码的实际执行顺序与阅读顺序不一致，使得代码难以理解和维护。开发者可能需要花费额外精力去追踪变量实际声明的位置。
    
2. **意外的行为和错误**：如果开发者对变量提升缺乏足够理解，他们可能会错误地以为变量在其被赋值的地方才被声明。这可能导致变量在预期赋值之前被访问时是`undefined`，从而引发意料之外的错误或难以追踪的逻辑问题。
    
3. **潜在的命名冲突**：函数声明的提升可能会覆盖同名的变量声明，或者在不同的作用域中重复声明相同的变量或函数名称，这可能导致难以预料的结果，尤其是当这些声明分布在代码的不同部分时。
    
4. **限制了严格模式的使用**：在严格模式（'use strict'）下，变量提升的某些行为会有所改变，比如未声明的变量使用会抛出错误，但即便如此，变量提升依然可能导致意料之外的问题，尤其是当代码混合使用严格和非严格模式编写时。
    
5. **不利于现代编程习惯**：随着ES6及以后版本的推出，`let`和`const`关键字以及块级作用域的引入，推荐更加明确和严格的变量声明方式。变量提升与这些新特性结合时可能产生混淆，尤其是在涉及到TDZ（Temporal Dead Zone）的情况下。

## 1.4 引起的具体问题

- 误用未初始化的变量：如果开发者在变量声明前访问该变量，其值将是`undefined`，可能导致逻辑错误，如错误的计算结果或条件判断。
- 函数和变量声明覆盖：在同一个作用域内，函数声明会覆盖同名的变量声明，导致预期的变量变成函数。
- 作用域混淆：变量提升可能使开发者误判变量的作用域，尤其是在嵌套作用域和循环中使用`var`声明变量时，可能导致预期之外的变量共享问题。

现代JavaScript实践鼓励明确和尽早声明变量，使用`let`和`const`来代替`var`，并且避免依赖于变量提升的行为，以增强代码的可读性和可维护性。
