---
title: V8引擎是如何执行JavaScript代码的?
tags:
  - js
  - 面试题
date: 2024-05-28
---

# 一 V8引擎是如何执行JavaScript代码的?

V8引擎执行JavaScript代码的流程包含以下几个关键步骤：

1. **解析（Parsing）**：
    - **生成抽象语法树（AST）**：V8引擎首先读取JavaScript源代码，并将其转换为抽象语法树（Abstract Syntax Tree）。AST是一种树状结构，直观地展现了代码的语法结构，便于引擎后续处理。
2. **字节码生成（Ignition）**：
    - **Ignition解释器**：V8使用Ignition解释器将AST转换为字节码（Bytecode）。字节码是一种低级的、平台无关的中间表示形式，易于生成和执行。Ignition在解释执行字节码的同时，也会收集代码执行的统计信息，为下一步的优化做准备。
3. **即时编译（JIT）**：
    - **TurboFan编译器**：基于Ignition收集的信息，V8的TurboFan编译器会将热点代码（即经常执行的代码路径）从字节码进一步编译为高度优化的机器码。这个过程包括了许多高级优化，如内联缓存、类型专化等，以提升执行效率。
4. **优化和反优化**：
    - V8会动态监控代码执行情况，如果发现先前做出的优化假设不再成立（例如，类型发生了改变），它会撤销优化，回到未优化的代码路径，确保正确性优先。
5. **垃圾回收（Orinoco）**：
    - 在代码执行过程中，V8的垃圾回收系统（项目代号Orinoco）会定期运行，负责回收不再使用的内存。它使用分代垃圾回收策略，区分年轻代和老年代对象，采用不同的回收算法来平衡性能和内存利用率。
6. **执行上下文与调用栈**：
    - 每当函数被调用时，V8会创建一个执行上下文，保存当前执行环境的信息，如变量、函数定义和`this`值。执行上下文被放置在调用栈中，随着函数的调用和返回，调用栈会相应地压栈和弹栈。
