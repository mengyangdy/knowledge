---
title: 解释跨站请求伪造(CSRF)攻击及其防御机制?
tags:
  - 浏览器
  - 面试题
date: 2024-06-03
---
# 一 解释跨站请求伪造(CSRF)攻击及其防御机制?

跨站请求伪造（Cross-Site Request Forgery, CSRF）是一种网络攻击手法，它利用用户浏览器中的登录状态（通常是通过Cookie维持的会话信息）向目标网站发送非用户本意的HTTP请求。攻击者通过诱导受害者在已经登录的状态下点击恶意链接或者访问嵌入恶意代码的网页，使浏览器在用户不知情的情况下执行操作，如转账、修改密码、发帖等。

## 1.1 CSRF攻击的关键要素：

1. **用户已登录目标网站**：攻击发生前，受害者需要在一个网站上保持活跃的登录状态。
2. **浏览器自动发送凭据**：浏览器会自动附带该网站的Cookie或认证信息到任何向该网站发送的请求中。
3. **受害者触发恶意请求**：攻击者通过各种手段（如电子邮件、即时消息、社交网络或第三方网站）诱骗用户点击链接或提交表单，而这个动作实际上触发了一个恶意请求。

## 1.2 防御机制：

为了防止CSRF攻击，可以采用以下几种策略：

1. **使用Anti-CSRF令牌（Token）**：服务器在生成表单时提供一个随机的、不可预测的Token，并将其作为隐藏字段包含在表单中。同时，该Token也会存储在用户的会话中。当表单提交时，服务器会验证提交的Token是否与会话中存储的一致。
    
2. **验证Referer头或Origin头**：检查HTTP请求的Referer或Origin头部，确认请求是从预期的源发起的。但需要注意，这个方法不是完全可靠，因为Referer头可以被伪造或某些情况下被禁用。
    
3. **使用SameSite Cookie属性**：设置敏感Cookie的SameSite属性为“Lax”或“Strict”，可以减少跨站请求时Cookie的发送，从而提供一定程度的防护。
    
4. **实施HTTP-only Cookie**：标记敏感Cookie为HTTP-only，可以防止JavaScript访问这些Cookie，减少通过XSS获取Cookie进而构造CSRF攻击的风险。
    
5. **双重认证**：对关键操作要求二次验证，如短信验证码、应用内通知确认等，增加攻击难度。
    
6. **用户交互确认**：对于敏感操作，要求用户进行额外确认，如重新输入密码。
    
7. **内容安全策略（CSP）**：虽然主要是针对XSS的防护，但合理的CSP设置也能间接提升对CSRF的防御能力。
    

通过上述措施的组合使用，可以有效降低跨站请求伪造攻击的成功率，保护用户和系统的安全。