---
title: 描述浏览器如何处理强缓存和协商缓存的决策过程
tags:
  - 浏览器
  - 面试题
date: 2024-06-03
---
# 一描述浏览器如何处理强缓存和协商缓存的决策过程

浏览器处理强缓存和协商缓存的决策过程遵循一定的逻辑顺序，旨在高效地利用缓存资源，同时确保内容的新鲜度。这一过程可以分为以下几个步骤：

## 1.1 请求资源前的检查

- **检查本地缓存**：当浏览器需要一个资源时，首先检查本地缓存（包括内存缓存和硬盘缓存），查找是否有该资源的副本。
- **强缓存检查**：如果找到资源副本，浏览器会检查资源的缓存策略，特别是`Cache-Control`中的`max-age`值或`Expires`头部。如果当前时间距离资源缓存的时间未超过指定的最大年龄，浏览器直接使用缓存中的资源，无需向服务器发送请求。这一步骤属于强缓存，提高了响应速度，减少了网络流量。

## 1.2 强缓存失效后的协商缓存

- **资源过期或无强缓存指令**：如果强缓存条件不满足（例如资源过期），或者资源没有强缓存策略，浏览器会进入协商缓存阶段。
- **构建验证请求**：浏览器构造一个HTTP请求，请求中包含上次缓存该资源时服务器提供的验证信息，即`ETag`（通过`If-None-Match`字段）或`Last-Modified`（通过`If-Modified-Since`字段）。
- **向服务器发送验证请求**：这个请求被发送到服务器，询问资源是否有所更新。与完全重新下载资源相比，这个请求体积小，节省了带宽。

## 1.3 服务器响应

- **资源未修改**：如果服务器上的资源自上次以来没有变化，服务器将响应一个304 Not Modified状态码，同时不包含资源的实际内容。这告诉浏览器可以安全地使用本地缓存的副本。
- **资源已修改**：相反，如果资源已被修改，服务器会响应一个200 OK状态码，并包含资源的最新内容，以及可能更新的缓存控制指令，以便浏览器更新本地缓存。

## 1.4 更新本地缓存

- 如果服务器返回了新的资源内容（即200响应），浏览器会更新本地缓存，设置新的缓存策略（如果有的话），并使用新内容。
- 对于304响应，浏览器维持原样使用本地缓存，但可能会更新资源的其他元数据（如过期时间）以反映服务器的最新信息。

通过上述流程，浏览器确保了既能高效利用缓存资源加速页面加载，又能及时获取到资源的最新版本，实现了性能与内容新鲜度之间的平衡。